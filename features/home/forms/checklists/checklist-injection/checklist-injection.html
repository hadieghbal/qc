<div id="checklist-injection-page">
  <style>
    #mobile-form-wrapper {
      display: block !important;
    }
    .actions-container {
      justify-content: center;
    }
    /* حل مشکل اسکرول در Choices.js */
    .choices__list--dropdown {
      max-height: 300px !important;
      overflow-y: auto !important;
    }
    .choices__list--dropdown .choices__item {
      padding: 10px 12px !important;
      font-size: 14.5px !important;
    }
  </style>

  <div class="top-controls">
    <div class="form-meta">
      <label for="date_input" class="required">تاریخ:</label>
      <input type="text" id="date_input" required />
    </div>
    <div class="form-meta">
      <label for="hall_input" class="required">سالن:</label>
      <select id="hall_input" required></select>
    </div>
    <div class="form-meta">
      <label for="shift_input" class="required">شیفت:</label>
      <select id="shift_input" required></select>
    </div>
    <div class="form-meta">
      <label for="time_slot_input" class="required">ساعت:</label>
      <select id="time_slot_input" required></select>
    </div>
  </div>

  <table style="display: none">
    <tbody id="main-table-body"></tbody>
  </table>

  <div id="mobile-form-wrapper">
    <div class="mobile-form-container">
      <h3>ثبت اطلاعات دستگاه و کنترل کیفی</h3>

      <!-- دستگاه -->
      <div class="mobile-form-group">
        <label for="mobile-device-name" class="required">دستگاه:</label>
        <select id="mobile-device-name" required></select>
      </div>

      <!-- قطعه -->
      <div class="mobile-form-group">
        <label class="required">قطعه:</label>
        <div id="mobile-parts-container" class="dynamic-list-wrapper"></div>
      </div>

      <!-- نوع تولید -->
      <div class="mobile-form-group">
        <label for="mobile-inspection-type" class="required">نوع تولید:</label>
        <select id="mobile-inspection-type" required>
          <option value="" disabled selected>انتخاب کنید...</option>
          <option value="initial">تولید اول (۵ نمونه)</option>
          <option value="routine">حین تولید (دوره‌ای - ۲ نمونه)</option>
        </select>
      </div>

      <!-- مواد و مستربچ -->
      <div class="mobile-form-group">
        <label class="required">مواد مصرفی:</label>
        <div id="mobile-materials-container" class="dynamic-list-wrapper"></div>
      </div>
      <div class="mobile-form-group">
        <label>مستربچ:</label>
        <div
          id="mobile-masterbatches-container"
          class="dynamic-list-wrapper"
        ></div>
      </div>

      <!-- وزن (جدید) -->
      <div class="mobile-form-group">
        <label for="mobile-weight" class="required">وزن (گرم):</label>
        <input
          type="number"
          id="mobile-weight"
          step="0.01"
          placeholder="مثلاً ۱۲۰.۵"
          required
        />
      </div>

      <!-- سیکل زمانی -->
      <div class="mobile-form-group">
        <label for="mobile-cycleTime" class="required"
          >سیکل زمانی (ثانیه):</label
        >
        <input
          type="number"
          id="mobile-cycleTime"
          placeholder="مثلاً ۴۵"
          required
        />
      </div>

      <hr class="form-divider" />

      <!-- سریال + چک‌باکس‌ها -->
      <div class="qc-grid-container">
        <div class="qc-grid-row">
          <div class="qc-grid-label required">شماره سریال:</div>
          <div class="qc-grid-inputs" id="serial-inputs-wrapper">
            <input
              type="tel"
              inputmode="numeric"
              pattern="[0-9]{8,20}"
              class="serial-input"
              placeholder="سریال اصلی"
              data-index="0"
              title="۸ تا ۲۰ رقم"
            />
            <input
              type="number"
              inputmode="numeric"
              class="serial-input"
              placeholder="4رقم"
              data-index="1"
            />
            <input
              type="number"
              inputmode="numeric"
              class="serial-input"
              placeholder="4رقم"
              data-index="2"
            />
            <input
              type="number"
              inputmode="numeric"
              class="serial-input"
              placeholder="4رقم"
              data-index="3"
            />
            <input
              type="number"
              inputmode="numeric"
              class="serial-input"
              placeholder="4رقم"
              data-index="4"
            />
          </div>
        </div>

        <div class="qc-grid-row">
          <div class="qc-grid-label required">ظاهری:</div>
          <div class="qc-grid-checks check-group" data-prop="appearance">
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
          </div>
        </div>
        <div class="qc-grid-row">
          <div class="qc-grid-label required">مونتاژی:</div>
          <div class="qc-grid-checks check-group" data-prop="assembly">
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
          </div>
        </div>
        <div class="qc-grid-row">
          <div class="qc-grid-label required">بسته‌بندی:</div>
          <div class="qc-grid-checks check-group" data-prop="packaging">
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
            <div class="check-box"></div>
          </div>
        </div>
      </div>

      <hr class="form-divider" />

      <div class="mobile-form-group defect-group">
        <label for="mobile-defects-summary" id="defects-summary-label"
          >شرح نقص:</label
        >
        <input
          type="text"
          id="mobile-defects-summary"
          readonly
          placeholder="در صورت NG از لیست انتخاب کنید"
        />
        <div id="injection-legends-wrapper-mobile"></div>
      </div>

      <div class="mobile-form-group">
        <label for="mobile-notes">توضیحات اضافی:</label>
        <input type="text" id="mobile-notes" placeholder="اختیاری" />
      </div>

      <button id="mobile-add-btn" class="action-btn" style="margin-top: 20px">
        ثبت و افزودن به لیست
      </button>
    </div>

    <ul id="mobile-summary-list"></ul>
  </div>

  <div class="approvers-container">
    <h4>تایید کنندگان نهایی</h4>
    <div class="approver-group">
      <label for="approver-qc" class="required">۱. بازرس کنترل کیفیت:</label>
      <input type="text" id="approver-qc" required />
    </div>
    <div class="approver-group">
      <label for="approver-prod" class="required">۲. سرپرست شیفت:</label>
      <input type="text" id="approver-prod" required />
    </div>
    <div class="approver-group">
      <label for="approver-shift" class="required"
        >۳. سرپرست کنترل کیفیت:</label
      >
      <input type="text" id="approver-shift" required />
    </div>
  </div>

  <div class="actions-container">
    <button id="finalize-btn" class="action-btn finalize-btn">
      ثبت نهایی فرم
    </button>
    <button
      id="export-csv-btn"
      class="action-btn export-btn"
      style="display: none"
    >
      خروجی CSV
    </button>
    <button
      id="export-img-btn"
      class="action-btn export-img-btn"
      style="display: none"
    >
      خروجی تصویر فرم
    </button>
  </div>

  <div class="print-page-container"></div>
</div>

<div
  id="injection-legends-main"
  class="legends-container-full"
  style="display: none"
>
  <h4>برای ثبت نقص کلیک کنید:</h4>
  <ul class="legends-list"></ul>
</div>
