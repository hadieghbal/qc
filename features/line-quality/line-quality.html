<div id="scrap-form-page">
  <style>
    html, body {
      overscroll-behavior-y: contain;
    }
    #mobile-form-wrapper {
      display: block !important;
    }
    .actions-container {
      justify-content: center;
    }
    #bom-part-code:read-only {
      background-color: #e9ecef;
      cursor: default;
      text-align: center;
      font-weight: bold;
      letter-spacing: 2px;
      color: var(--primary-color);
    }
    .top-controls.locked .choices__inner,
    .top-controls.locked input,
    .top-controls.locked select {
        background-color: #eef2f7 !important;
        cursor: not-allowed;
    }
    .top-controls {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      align-items: center;
    }
    /* استایل برای فیلد فقط خواندنی */
    #mobile-total-production:read-only {
      background-color: #e9ecef;
      cursor: default;
    }
    @media (max-width: 576px) {
      .top-controls {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <div class="top-controls">
    <div class="form-meta">
      <label for="jalali_date">تاریخ :</label>
      <input type="text" id="jalali_date" name="date" autocomplete="off" />
    </div>
    <div class="form-meta">
      <label for="line">خط :</label>
      <select id="line" name="line"></select>
    </div>
    <div class="form-meta">
        <label for="bom-product-type">نوع محصول:</label>
        <select id="bom-product-type" placeholder="انتخاب نوع محصول..."></select>
    </div>
    <div class="form-meta">
        <label for="bom-model">مدل:</label>
        <select id="bom-model" placeholder="ابتدا نوع را انتخاب کنید..." disabled></select>
    </div>
    <div class="form-meta">
        <label for="mobile-group">گروه:</label>
        <select id="mobile-group" data-required-name="گروه"></select>
    </div>
    <div class="form-meta">
        <label for="mobile-item">آیتم:</label>
        <input type="number" id="mobile-item" data-required-name="آیتم" />
    </div>
  </div>

  <table style="display: none">
    <tbody id="main-table-body"></tbody>
  </table>

  <div id="mobile-form-wrapper">
    <div class="mobile-form-container">
      <h3><i class="bi bi-plus-circle-dotted"></i> ثبت آمار و نقص قطعه</h3>
      <div class="accordion-header active">
        آمار تولید <i class="bi bi-chevron-down"></i>
      </div>
      <div class="accordion-content" style="display: flex">
        <div class="mobile-form-group">
            <label for="mobile-total-production">تعداد کل تولید (محاسباتی):</label>
            <div class="counter-input-group">
              <button type="button" class="counter-btn plus-btn" data-target="mobile-total-production" disabled>+</button>
              <input type="number" id="mobile-total-production" value="0" min="0" data-required-name="تعداد کل تولید" readonly/>
              <button type="button" class="counter-btn minus-btn" data-target="mobile-total-production" disabled>−</button>
            </div>
        </div>
        <div class="mobile-form-group">
            <label for="mobile-repaired-count">تعداد تعمیرگاهی:</label>
            <div class="counter-input-group">
              <button type="button" class="counter-btn plus-btn" data-target="mobile-repaired-count">+</button>
              <input type="number" id="mobile-repaired-count" value="0" min="0"/>
              <button type="button" class="counter-btn minus-btn" data-target="mobile-repaired-count">−</button>
            </div>
        </div>
        <div class="mobile-form-group">
            <label for="mobile-ok-count">تعداد سالم:</label>
            <div class="counter-input-group">
              <button type="button" class="counter-btn plus-btn" data-target="mobile-ok-count">+</button>
              <input type="number" id="mobile-ok-count" value="0" min="0"/>
              <button type="button" class="counter-btn minus-btn" data-target="mobile-ok-count">−</button>
            </div>
        </div>
      </div>
      <div class="accordion-header">
        نقص قطعه <i class="bi bi-chevron-down"></i>
      </div>
      <div class="accordion-content">
        <div class="mobile-form-group">
            <label for="bom-part-name" class="required">نام قطعه:</label>
            <select id="bom-part-name" placeholder="ابتدا مدل را انتخاب کنید..." disabled></select>
        </div>
        <div class="mobile-form-group">
            <label for="bom-part-code">کد قطعه:</label>
            <input type="text" id="bom-part-code" placeholder="کد اینجا نمایش داده می‌شود" readonly/>
        </div>
        <div class="mobile-form-group">
          <label for="mobile-defect-operator">اپراتوری:</label>
          <div class="counter-input-group">
            <button type="button" class="counter-btn plus-btn" data-target="mobile-defect-operator">+</button>
            <input type="number" id="mobile-defect-operator" value="0" min="0" />
            <button type="button" class="counter-btn minus-btn" data-target="mobile-defect-operator">−</button>
          </div>
        </div>
        <div class="mobile-form-group">
          <label for="mobile-defect-visual">ظاهری:</label>
          <div class="counter-input-group">
            <button type="button" class="counter-btn plus-btn" data-target="mobile-defect-visual">+</button>
            <input type="number" id="mobile-defect-visual" value="0" min="0" />
            <button type="button" class="counter-btn minus-btn" data-target="mobile-defect-visual">−</button>
          </div>
        </div>
        <div class="mobile-form-group">
          <label for="mobile-defect-technical">فنی:</label>
          <div class="counter-input-group">
            <button type="button" class="counter-btn plus-btn" data-target="mobile-defect-technical">+</button>
            <input type="number" id="mobile-defect-technical" value="0" min="0" />
            <button type="button" class="counter-btn minus-btn" data-target="mobile-defect-technical">−</button>
          </div>
        </div>
        <div class="mobile-form-group">
          <label for="mobile-defect-other">سایر:</label>
          <div class="counter-input-group">
            <button type="button" class="counter-btn plus-btn" data-target="mobile-defect-other">+</button>
            <input type="number" id="mobile-defect-other" value="0" min="0" />
            <button type="button" class="counter-btn minus-btn" data-target="mobile-defect-other">−</button>
          </div>
        </div>
        <div class="mobile-form-group">
          <label for="mobile-defect-cleaning">نظافت:</label>
          <div class="counter-input-group">
            <button type="button" class="counter-btn plus-btn" data-target="mobile-defect-cleaning">+</button>
            <input type="number" id="mobile-defect-cleaning" value="0" min="0" />
            <button type="button" class="counter-btn minus-btn" data-target="mobile-defect-cleaning">−</button>
          </div>
        </div>
        <div class="mobile-form-group">
          <label for="mobile-comments">توضیحات:</label>
          <input type="text" id="mobile-comments" />
        </div>
      </div>
      <button type="button" id="mobile-add-btn" class="action-btn">
        <i class="bi bi-check-circle-fill"></i> ثبت و افزودن به لیست
      </button>
    </div>
    <ul id="mobile-summary-list"></ul>
  </div>

  <div class="approvers-container">
    <h4><i class="bi bi-patch-check-fill"></i> تایید کنندگان نهایی</h4>
    <div class="approver-group">
      <label for="approver-control">1. نماینده کنترل:</label>
      <input type="text" id="approver-control" />
    </div>
    <div class="approver-group">
      <label for="approver-line">2. نماینده تولید:</label>
      <input type="text" id="approver-line" />
    </div>
  </div>

  <div class="actions-container">
    <button type="button" class="action-btn finalize-btn">
      <i class="bi bi-check2-circle"></i> ثبت نهایی فرم
    </button>
    <button type="button" class="action-btn export-csv-btn" style="display: none">
      <i class="bi bi-file-earmark-spreadsheet-fill"></i> خروجی CSV
    </button>
  </div>

  <div class="print-page-container"></div>
</div>